<!DOCTYPE html>
<html class="ui-page-login">

<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>找回密码</title>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/style.css" rel="stylesheet"/>
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/public.js" type="text/javascript" charset="utf-8"></script>
    <style>
        .wsp2 {
            word-spacing: 1.5rem;
        }

        .wsp3 {
            word-spacing: 0.2rem;
        }

        .area {
            margin: 20px auto 0;
        }

        .mui-input-group label {
            width: 31%;
            font-size: 16px;
        }

        .mui-input-row label ~ input,
        .mui-input-row label ~ select,
        .mui-input-row label ~ textarea {
            width: 69%;
            font-size: 16px;
        }

        .mui-checkbox input[type=checkbox],
        .mui-radio input[type=radio] {
            top: 6px;
        }

        .mui-content-padded {
            margin-top: 25px;
        }

        .mui-btn {
            padding: 10px;
        }

        #identifyingCode,
        #identifyingCode1 {
            position: absolute;
            width: 30%;
            height: 100%;
            right: 2px;
            line-height: inherit;
        }

        .mui-control-content {
            background-color: white;
            min-height: 88.4vh;
        }

        .mui-control-content .mui-loading {
            margin-top: 50px;
        }

        .mui-input-group:before {
            height: 0;
        }
    </style>
</head>

<body>
<header class="bg mui-bar mui-bar-nav">
    <a class="bg mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <!--<h1 class="bg mui-title">注册</h1>-->
</header>
<div class="mui-content">
    <div id="slider" class="mui-slider">
        <div id="sliderSegmentedControl"
             class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
            <a class="mui-control-item mui-active" href="#item1mobile">
                个人找回
            </a>
            <a class="mui-control-item" href="#item2mobile">
                企业找回
            </a>

        </div>
        <div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6"></div>
        <div class="mui-slider-group">
            <div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
                <div id="scroll1" class="mui-scroll-wrapper">
                    <div class="mui-scroll">
                        <form class="mui-input-group">
                            <div class="mui-input-row">
                                <label class="wsp2">身份证号</label>
                                <input id='idCard' type="text" class="mui-input-clear mui-input" placeholder="请输入身份证号码">
                            </div>
                            <div class="mui-input-row">
                                <label class="wsp3">验 证 码</label>
                                <input id="smscode" type="number" class="mui-input-clear mui-input"
                                       placeholder="请输入验证码">
                                <button id="identifyingCode" type="button" class="bg mui-btn mui-btn-primary"/>
                                获取验证码</button>

                            </div>
                            <div class="mui-input-row">
                                <label class="wsp2">新设密码</label>
                                <input id='password' type="password" class="mui-input-clear mui-input"
                                       placeholder="请输入密码">
                            </div>
                            <div class="mui-input-row">
                                <label class="wsp2">密码确认</label>
                                <input id='password_confirm' type="password" class="mui-input-clear mui-input"
                                       placeholder="请确认密码">
                            </div>

                        </form>

                        <div class="mui-content-padded">
                            <button id='forget' class="bg reg mui-btn mui-btn-block mui-btn-primary">找回</button>
                        </div>

                    </div>

                </div>
            </div>
            <div id="item2mobile" class="mui-slider-item mui-control-content">
                <div id="scroll2" class="mui-scroll-wrapper">
                    <div class="mui-scroll">
                        <form class="mui-input-group">
                            <div class="mui-input-row">
                                <label class="wsp2">社会信用代码</label>
                                <input id='idCard1' type="text" class="mui-input-clear mui-input"
                                       placeholder="请输入社会信用代码">
                            </div>
                            <div class="mui-input-row">
                                <label class="wsp3">验 证 码</label>
                                <input id="smscode1" type="number" class="mui-input-clear mui-input"
                                       placeholder="请输入验证码">
                                <button id="identifyingCode1" type="button" class="bg mui-btn mui-btn-primary"/>
                                获取验证码</button>

                            </div>
                            <div class="mui-input-row">
                                <label class="wsp2">新设密码</label>
                                <input id='password1' type="password" class="mui-input-clear mui-input"
                                       placeholder="请输入密码">
                            </div>
                            <div class="mui-input-row">
                                <label>密码确认</label>
                                <input id='password_confirm1' type="password" class="mui-input-clear mui-input"
                                       placeholder="请确认密码">
                            </div>

                        </form>

                        <div class="mui-content-padded">
                            <button id='forget1' class="reg1 mui-btn mui-btn-block mui-btn-primary">找回</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

</div>
<script src="js/mui.min.js"></script>
<script src="js/app.js"></script>
<script>
    var reg = /^[A-Za-z0-9]{6,16}$/;
    var forget = document.getElementById("forget");
    var forget1 = document.getElementById("forget1");
    var identifyingCode = document.getElementById("identifyingCode");
    var identifyingCode1 = document.getElementById("identifyingCode1");
    var idcard = document.getElementById("idCard");
    var idcard1 = document.getElementById("idCard1");
    var password = document.getElementById("password");
    var password1 = document.getElementById("password1");
    var password_confirm = document.getElementById("password_confirm");
    var password_confirm1 = document.getElementById("password_confirm1");
    var smscode = document.getElementById("smscode");
    var smscode1 = document.getElementById("smscode1");
    isIDCard = /^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{4}$/;
    var id1 = idcard1.value;
    var wait = 60;
    var wait1 = 60;
    var countdown = document.getElementById("identifyingCode");

    //个人验证码
    identifyingCode.addEventListener("tap", function () {
        if (idcard.value.length == 18) {
            if (!isIDCard.test(idcard.value)) {
                mui.toast('身份证号错误');
                return;
            }
        } else {
            mui.toast("请输入正确的身份证号");
            return;
        }

        setTime();
        smsSend(idcard.value, 1);
    })

    //个人找回
    forget.addEventListener("tap", function () {

        if (idcard.value.length == 18) {
            if (!isIDCard.test(idcard.value)) {
                mui.toast('身份证号错误');
                return;
            }
        } else {
            mui.toast("请输入正确的身份证号");
            return;
        }
        if (!reg.test(password.value)) {
            mui.toast('密码必须由 6-16位字母、数字组成');
            return;
        }
        if (password_confirm.value != password.value) {
            mui.toast("密码两次输入不一致")
            return;
        }
        forgetPerson({
            idCard: idcard.value,
            password: password.value,
            password2: password_confirm.value,
            smsCode: smscode.value
        });

    })

    //企业验证码
    identifyingCode1.addEventListener("tap", function () {

        if (idcard1.value.length != 18) {
            mui.toast("请输入正确的社会信用代码")
            return;
        }

        setTime1();

        smsSend(id1, 2)
    })
    //企业找回
    forget1.addEventListener("tap", function () {
        if (idcard1.value.length != 18) {
            mui.toast("请输入正确的社会信用代码")
            return;
        }

        if (!reg.test(password1.value)) {
            mui.toast('密码必须由 6-16位字母、数字组成');
            return;
        }
        if (password_confirm1.value != password1.value) {
            mui.toast("密码两次输入不一致")
            return;
        }

        forgetEnterprise({
            creditCode: idcard1.value,
            password: password1.value,
            password2: password_confirm1.value,
            smsCode: smscode1.value
        });

    })

    function smsSend(uniqueCode, userType) {
        $.post(API_HOST + "/sms/forgot.json", {
            uniqueCode: uniqueCode,
            userType: userType
        }, function (response) {
            mui.toast(response.msg);
        });
    }

    //企业找回
    function forgetEnterprise(parameter) {
        $.post(API_HOST + '/forgot/enterprise.json', parameter, function (response) {
            //									console.info(response);
            if (response.success) {
                mui.toast(response.msg);
                location.href = "enterpriseLogin.html";
            } else {
                mui.toast(response.msg);

            }

        });
    }

    //个人找回
    function forgetPerson(params) {
        $.post(API_HOST + '/forgot/person.json', params, function (response) {

            //														console.info(response);
            if (response.success) {
                mui.toast(response.msg);
                location.href = "login.html";
            } else {
                mui.toast(response.msg);

            }

        });
    }

    function setTime() {
        if (wait == 0) {
            countdown.removeAttribute("disabled");
            countdown.innerHTML = "获取验证码";
            wait = 60;
        } else {
            countdown.disabled = "true";
            countdown.innerHTML = "" + wait + "秒后重试";
            wait--;
            setTimeout(setTime, 1000)
        }

    }

    function setTime1() {
        if (wait1 == 0) {
            identifyingCode1.removeAttribute("disabled");
            identifyingCode1.innerHTML = "获取验证码";
            wait1 = 60;
        } else {
            identifyingCode1.disabled = "true";
            identifyingCode1.innerHTML = "" + wait1 + "秒后重试";
            wait1--;
            setTimeout(setTime1, 1000)
        }

    }
</script>
</body>

</html>